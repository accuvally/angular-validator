(function(){var m;m=angular.element;angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(p){return{restrict:"A",require:"ngModel",link:function(g,q,b){var f,a,c,n,d,h,t,l,s;a=p.get("$validator");f=p.get("$parse");n=f(b.ngModel);l=[];s=function(r,e){var k,a,c,d,f,h;null==e&&(e={});c=0;k=function(){var a,k,r;if(++c===l.length){k=0;for(r=l.length;k<r;k++)a=l[k],a.success(n(g),g,q,b,p);"function"===typeof e.success&&e.success()}};h=[];d=0;for(f=l.length;d<
f;d++){a=l[d];switch(r){case "blur":if("blur"!==a.invoke)continue;a.enableError=!0;break;case "watch":if("watch"!==a.invoke&&!a.enableError){k();continue}break;case "broadcast":a.enableError=!0}h.push(function(a){return a.validator(n(g),g,q,b,{success:function(){return k()},error:function(){a.enableError&&a.error(n(g),g,q,b,p);if(1===("function"===typeof e.error?e.error():void 0)){try{q[0].scrollIntoViewIfNeeded()}catch(k){}return q[0].select()}}})}(a))}return h};h=function(){var b;b=a.getRule("required");
null==b&&(b=a.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return l.push(b)};t=function(a){var e,k,c,d,f;f=[];e=k=0;for(c=l.length;k<c;e=k+=1)(null!=(d=l[e])?d.name:void 0)===a&&(l[e].success(n(g),g,q,b,p),l.splice(e,1),f.push(e--));return f};b.$observe("validator",function(c){var e,k,f,n;l.length=0;(d.validatorRequired||d.required)&&h();if(e=c.match(/^\/(.*)\/$/))k=a.convertRule("dynamic",{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:b.validatorError}),l.push(k);else if(e=
c.match(/^\[(.*)\]$/)){c=e[1].split(",");n=[];e=0;for(f=c.length;e<f;e++)k=c[e],k=a.getRule(k.replace(/^\s+|\s+$/g,"")),"function"===typeof k.init&&k.init(g,q,b,p),k?n.push(l.push(k)):n.push(void 0);return n}});b.$observe("validatorError",function(c){var e;if(e=b.validator.match(/^\/(.*)\/$/))return t("dynamic"),c=a.convertRule("dynamic",{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:c}),l.push(c)});d={validatorRequired:!1,required:!1};b.$observe("validatorRequired",function(a){if(a&&"false"!==
a)return h(),d.validatorRequired=!0;if(d.validatorRequired)return t("required"),d.validatorRequired=!1});b.$observe("required",function(a){if(a&&"false"!==a)return h(),d.required=!0;if(d.required)return t("required"),d.required=!1});c=function(a,e){var c,d;if(e){if(b.validatorGroup===e)return!0;if(a.targetScope===g)return 0===b.ngModel.indexOf(e);c=function(a,e){var b,d;for(b in a)switch(d=a[b],typeof d){case "string":if("$$hashKey"===b&&d===e)return!0;break;case "object":if(c(d,e))return!0}return!1};
d=b.ngModel.indexOf(".");d=0<=d?b.ngModel.substr(0,d):b.ngModel;d=f(d)(g);return c(f(e)(a.targetScope),d.$$hashKey)}return!0};g.$on(a.broadcastChannel.prepare,function(a,e){if(c(a,e.model))return e.accept()});g.$on(a.broadcastChannel.start,function(a,e){if(c(a,e.model))return s("broadcast",{success:e.success,error:e.error})});g.$on(a.broadcastChannel.reset,function(a,e){var k,d,f;if(c(a,e.model))for(d=0,f=l.length;d<f;d++)k=l[d],k.success(n(g),g,q,b,p),"watch"!==k.invoke&&(k.enableError=!1)});g.$watch(b.ngModel,
function(a,e){if(a!==e)return s("watch",{oldValue:e})});return m(q).bind("blur",function(){return g.$apply(function(){return s("blur")})})}}}])}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,g,q;q=g=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(b){p=b;g=p.get("$q");return q=p.get("$timeout")};this.convertError=function(b){var f;if("function"===typeof b)return b;f=b.constructor===String?b:"";return function(a,c,b,d){var h,g,l;c=m(b).parent();for(a=[];0!==c.length;){if(c.hasClass("form-group")){c.addClass("has-error");
l=c.find("label");h=0;for(g=l.length;h<g;h++)c=l[h],m(c).hasClass("error")&&m(c).remove();c=m("<label class='control-label error'>"+f+"</label>");d.id&&c.attr("for",d.id);m(b).parent().append(c);break}a.push(c=c.parent())}return a}};this.convertSuccess=function(b){return"function"===typeof b?b:function(b,a,c){var g,d;a=m(c).parent();for(b=[];0!==a.length;){if(a.hasClass("has-error")){a.removeClass("has-error");d=a.find("label");c=0;for(g=d.length;c<g;c++)a=d[c],m(a).hasClass("error")&&m(a).remove();
break}b.push(a=a.parent())}return b}};this.convertValidator=function(b){var f;f=function(){};b.constructor===RegExp?f=function(a,c,f,d,h){null==a&&(a="");return b.test(a)?"function"===typeof h.success?h.success():void 0:"function"===typeof h.error?h.error():void 0}:"function"===typeof b&&(f=function(a,c,f,d,h){return g.all([b(a,c,f,d,p)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof h.success?h.success():void 0:"function"===typeof h.error?h.error():void 0},function(){return"function"===
typeof h.error?h.error():void 0})});return f};this.convertRule=function(b){return function(f,a){var c,g,d;null==a&&(a={});c={name:f,enableError:"watch"===a.invoke,invoke:a.invoke,init:a.init,validator:null!=(g=a.validator)?g:function(){return!0},error:null!=(d=a.error)?d:"",success:a.success};c.error=b.convertError(c.error);c.success=b.convertSuccess(c.success);c.validator=b.convertValidator(c.validator);return c}}(this);this.register=function(b,f){null==f&&(f={});return this.rules[b]=this.convertRule(b,
f)};this.getRule=function(b){return this.rules[b]?this.rules[b]:null};this.validate=function(b){return function(f,a){var c,n,d,h,m,l,s,r;r=g.defer().promise;l=m=h=0;c=[];n=[];d=[];r.success=function(a){c.push(a);return r};r.error=function(a){n.push(a);return r};r.then=function(a){d.push(a);return r};s={model:a,accept:function(){return h++},success:function(){var a,b,f;if(++m===h){b=0;for(f=c.length;b<f;b++)a=c[b],a();b=0;for(f=d.length;b<f;b++)a=d[b],a()}return m},error:function(){var a,b,c;if(0===
l++){b=0;for(c=n.length;b<c;b++)a=n[b],a();b=0;for(c=d.length;b<c;b++)a=d[b],a()}return l}};f.$broadcast(b.broadcastChannel.prepare,s);q(function(){var a,b,d;if(0===h)for(b=0,d=c.length;b<d;b++)a=c[b],a();else return a=p.get("$validator"),f.$broadcast(a.broadcastChannel.start,s)});return r}}(this);this.reset=function(b){return function(f,a){return f.$broadcast(b.broadcastChannel.reset,{model:a})}}(this);this.get=function(b){this.setupProviders(b);return{rules:this.rules,broadcastChannel:this.broadcastChannel,
register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
